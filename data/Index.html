<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€“ Ø§Ù„ÙˆØ¯Ø¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
            --primary-bg: #0a0e13;
            --glass-bg: rgba(15, 20, 30, 0.4);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-hover-border: rgba(255, 255, 255, 0.15);
            
            /* Ø§Ù„Ù†ØµÙˆØµ */
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.85);
            --text-tertiary: rgba(255, 255, 255, 0.65);
            --text-accent: #64b5f6;
            
            /* Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª */
            --shadow-soft: 0 4px 24px rgba(0, 0, 0, 0.12);
            --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.18);
            --shadow-strong: 0 16px 48px rgba(0, 0, 0, 0.25);
            --blur-strength: 20px;
            --border-radius: 18px;
            --border-radius-small: 12px;

            /* Ù…Ù‚Ø§Ø³Ø§Øª Ù†Ù…Ø·ÙŠØ© Ù„Ù„ÙˆØ¯Ø¬Ø§Øª */
            --widget-min: 260px;
            --widget-row: 180px;
            
            /* Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª */
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            /* Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª Ø§Ù„Ù„ÙˆÙ†ÙŠØ© */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-warm: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-cool: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-sunset: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-ocean: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-cosmic: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
            --bg-animation-colors: #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe, #fa709a, #fee140;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Inter', 'Amiri', ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            font-optical-sizing: auto;
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
        }

        body {
            background: var(--primary-bg);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .canvas {
            position: fixed;
            inset: 0;
            width: 100vw; height: 100vh;
            overflow: hidden; display: flex;
        }
        .glass {
            position: absolute; inset: 0;
            background: linear-gradient(45deg, var(--bg-animation-colors));
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.15; filter: blur(100px) saturate(1.5) brightness(1.2);
            will-change: background-position;
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }
        .grain {
            position: absolute; inset: -10%;
            opacity: 0.03;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feComponentTransfer><feFuncA type="discrete" tableValues="0 0.5 0 0.3 0"/></feComponentTransfer></filter><rect width="100%" height="100%" filter="url(%23noiseFilter)"/></svg>');
            mix-blend-mode: overlay; pointer-events: none;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
        .status {
            position: absolute; top: var(--spacing-md); right: var(--spacing-lg);
            height: 40px; display: flex; align-items: center; justify-content: center;
            padding: 0 var(--spacing-md);
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-small);
            backdrop-filter: blur(var(--blur-strength)); -webkit-backdrop-filter: blur(var(--blur-strength));
            color: var(--text-primary); font-weight: 600; font-size: 14px; z-index: 100;
            box-shadow: var(--shadow-soft);
            transition: all .3s cubic-bezier(.4,0,.2,1);
        }
        .status:hover { background: rgba(15,20,30,.6); border-color: var(--glass-hover-border); transform: translateY(-2px); }

        /* ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© â€” Ø´Ø¨ÙƒØ© Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…Ø¹ Ø¹Ù…ÙˆØ¯ Ø¬Ø§Ù†Ø¨ÙŠ Ø«Ø§Ø¨Øª */
        .main-container {
            position: absolute;
            inset: 80px var(--spacing-xl) var(--spacing-xl) var(--spacing-xl);
            display: grid;
            grid-template-columns: 1fr clamp(320px, 28vw, 400px);
            grid-template-rows: 1fr;
            gap: var(--spacing-xl);
            align-items: start;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„ÙˆØ¯Ø¬Ø§Øª: ÙƒØ«Ø§ÙØ© Ø°ÙƒÙŠØ© + Ù…Ù†Ø§Ø·Ù‚ */
        .left-panel {
            min-width: 0;
            height: 100%;
            display: grid;
            grid-auto-flow: dense;
            grid-auto-rows: var(--widget-row);
            grid-template-columns: repeat(auto-fill, minmax(var(--widget-min), 1fr));
            gap: var(--spacing-lg);
            align-content: start;
        }

        /* Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª (Ø¨Ø¯ÙˆÙ† ØªØ±Ø­ÙŠÙ„ Ø³Ù„Ø¨ÙŠ) */
        .right-panel {
            position: sticky;
            top: 88px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            box-shadow: var(--shadow-soft);
        }

        .app-subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            letter-spacing: -0.02em;
        }

        .apps {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }

        /* Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .app-button {
            width: 100%;
            height: 76px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 16px; font-weight: 700;
            cursor: pointer;
            transition: all .35s cubic-bezier(.23,1,.32,1);
            display: flex; align-items: center; justify-content: center; gap: var(--spacing-md);
            text-decoration: none; position: relative; overflow: hidden;
        }
        .app-button::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
            opacity: 0; transition: opacity .35s ease;
        }
        .app-button .icon { font-size: 24px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.3)); }
        .app-button:hover { transform: translateY(-4px); box-shadow: var(--shadow-medium); border-color: var(--glass-hover-border); background: rgba(15,20,30,.55); }
        .app-button:hover::before { opacity: 1; }

        /* Ø§Ù„ÙˆØ¯Ø¬Ø§Øª */
        .widget {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
            transition: transform .35s, box-shadow .35s, border-color .35s, background .35s;
            position: relative; overflow: hidden; min-width: 0;
        }
        .widget::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
            opacity: 0; transition: opacity .35s ease;
        }
        .widget:hover { transform: translateY(-6px); box-shadow: var(--shadow-medium); border-color: var(--glass-hover-border); background: rgba(15,20,30,.5); }
        .widget:hover::before { opacity: 1; }

        .widget .title {
            display: flex; align-items: center; gap: .5rem;
            font-weight: 800; font-size: 14px; letter-spacing: .3px; opacity: .95;
        }
        .widget .content {
            display: grid; align-content: center; gap: .25rem; min-width: 0;
        }
        .widget .value {
            font-size: clamp(28px, 4.5vw, 40px);
            font-weight: 900; line-height: 1;
            background: linear-gradient(135deg, #ffffff, #e8e8e8);
            background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .widget .sub { font-size: 13px; opacity: .85; color: var(--text-secondary); line-height: 1.4; font-weight: 600; }

        /* Ø£Ø­Ø¬Ø§Ù… Ø«Ø§Ø¨ØªØ© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© */
        .widget--tall { grid-row: span 2; }
        .widget--wide { grid-column: span 2; }

        /* ÙˆØ¯Ø¬Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø± */
        #wgAdhkar { background: linear-gradient(135deg, rgba(15,20,30,.6), rgba(25,30,40,.4)); }
        #wgAdhkar .value { font-size: clamp(16px, 2.6vw, 20px); font-weight: 700; -webkit-text-fill-color: var(--text-primary); white-space: normal; line-height: 1.6; text-align: center; padding: 0 var(--spacing-sm); }
        #wgAdhkar .content { text-align: center; padding: 0 var(--spacing-md); }
        #wgAdhkar .sub { text-align: center; font-size: 12px; opacity: .7; color: var(--text-tertiary); margin-top: var(--spacing-xs); }

        /* ØªÙ…ÙŠÙŠØ² Ù„ÙˆÙ†ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¯Ø¬Ø© */
        #wgCal    { background: linear-gradient(135deg, rgba(103,126,234,.1), rgba(118,75,162,.1)); }
        #wgClock  { background: linear-gradient(135deg, rgba(240,147,251,.1), rgba(245,87,108,.1)); }
        #wgTemp   { background: linear-gradient(135deg, rgba(79,172,254,.1), rgba(0,242,254,.1)); }
        #wgWeather{ background: linear-gradient(135deg, rgba(250,112,154,.1), rgba(254,225,64,.1)); }

        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .widget.loading .value::after {
            content: ''; display: inline-block; width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,.2); border-radius: 50%;
            border-top-color: var(--text-accent); animation: spin 1s linear infinite; margin-inline-start: var(--spacing-xs);
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error { color: #ff6b6b !important; opacity: .9; }

        /* Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ */
        .widget:focus, .app-button:focus { outline: 2px solid var(--text-accent); outline-offset: 2px; }

        /* Ø£Ø¯Ø§Ø¡ */
        .widget, .app-button { will-change: transform; contain: layout style paint; }

        /* ØªØ¬Ø§ÙˆØ¨ÙŠØ© */
        @media (max-width: 1200px) {
            .main-container { inset: 80px var(--spacing-lg) var(--spacing-lg) var(--spacing-lg); grid-template-columns: 1fr clamp(280px, 33vw, 360px); gap: var(--spacing-lg); }
            :root { --widget-min: 220px; --widget-row: 160px; }
        }
        @media (max-width: 900px) {
            .main-container { display: flex; flex-direction: column; overflow: auto; }
            .right-panel { position: relative; top: 0; }
            .apps { grid-template-columns: repeat(2, minmax(0,1fr)); }
        }
        @media (max-width: 620px) {
            :root { --widget-min: 100%; --widget-row: 140px; }
            .apps { grid-template-columns: 1fr; }
            .status { font-size: 13px; height: 36px; }
        }

        @media (prefers-reduced-motion: reduce) {
            .glass { animation: none; }
            .widget, .app-button { transition: none; }
        }
    </style>
</head>
<body>
    <div class="canvas">
        <div class="glass"></div>
        <div class="grain"></div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="status"><div id="clock">--:--</div></div>

        <!-- Ø§Ù„ØªØ®Ø·ÙŠØ· -->
        <div class="main-container">
            <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙŠØ³Ø±Ù‰: ÙˆØ¯Ø¬Ø§Øª -->
            <section class="left-panel">
                <!-- Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø¹Ø§Ø¯ÙŠ) -->
                <article class="widget" id="wgCal" tabindex="0" role="button" aria-label="Ø§Ù„ØªÙ‚ÙˆÙŠÙ…">
                    <div class="title">ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
                    <div class="content">
                        <div class="value" id="wgCalVal">--</div>
                        <div class="sub" id="wgCalMonth">â€”</div>
                        <div class="sub" id="wgCalHijri">â€”</div>
                    </div>
                </article>

                <!-- Ø§Ù„Ø³Ø§Ø¹Ø© (Ø¹Ø§Ø¯ÙŠ) -->
                <article class="widget" id="wgClock" tabindex="0" role="button" aria-label="Ø§Ù„Ø³Ø§Ø¹Ø©">
                    <div class="title">ğŸ•’ Ø§Ù„Ø³Ø§Ø¹Ø©</div>
                    <div class="content">
                        <div class="value" id="wgClockVal">--:--</div>
                        <div class="sub" id="wgClockDay">â€”</div>
                    </div>
                </article>

                <!-- Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Ø¹Ø§Ø¯ÙŠ) -->
                <article class="widget" id="wgTemp" tabindex="0" role="button" aria-label="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©">
                    <div class="title">ğŸŒ¡ï¸ Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
                    <div class="content">
                        <div class="value" id="wgTempVal">--Â°</div>
                        <div class="sub" id="wgTempFeels">â€”</div>
                    </div>
                </article>

                <!-- Ø§Ù„Ø·Ù‚Ø³ (Ø¹Ø§Ø¯ÙŠ) -->
                <article class="widget" id="wgWeather" tabindex="0" role="button" aria-label="Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³">
                    <div class="title">ğŸŒ¤ï¸ Ø§Ù„Ø·Ù‚Ø³</div>
                    <div class="content">
                        <div class="value" id="wgWeatherVal">â€”</div>
                        <div class="sub" id="wgWeatherSub">â€”</div>
                    </div>
                </article>

                <!-- Ø§Ù„Ø£Ø°ÙƒØ§Ø± (ÙˆØ§Ø³Ø¹Ø© ÙˆØ·ÙˆÙŠÙ„Ø© Ù„ØªØ´ÙƒÙŠÙ„ Ù…Ø§Ù†Ø´ÙŠØª Ù…Ø±ØªØ¨) -->
                <article class="widget widget--wide widget--tall" id="wgAdhkar" tabindex="0" role="button" aria-label="Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©">
                    <div class="title">âœ¨ Ø£Ø°ÙƒØ§Ø± Ù…ØªÙ†ÙˆØ¹Ø©</div>
                    <div class="content">
                        <div class="value" id="wgAdhkarVal">ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                        <div class="sub" id="wgAdhkarSub">ÙŠØªØºÙŠØ± ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ</div>
                    </div>
                </article>
            </section>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª -->
            <aside class="right-panel" aria-label="Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª">
                <div class="app-subtitle">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</div>
                <div class="apps">
                    <a href="TEST.HTML" class="app-button" target="_blank" rel="noopener">
                        <span class="icon">ğŸ”</span><span class="text">Ø¨Ø­Ø« Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span>
                    </a>
                    <a href="wep.html" class="app-button" target="_blank" rel="noopener">
                        <span class="icon">ğŸ“Š</span><span class="text">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</span>
                    </a>
                </div>
            </aside>
        </div>
    </div>

    <script>
        class EnhancedDashboardApp {
            constructor() {
                this.config = {
                    defaultLocation: { lat: 24.7136, lon: 46.6753 },
                    updateIntervals: { clock: 1000, weather: 300000, adhkarRotation: 10000, hijri: 3600000 },
                    apis: {
                        weather: 'https://api.open-meteo.com/v1/forecast',
                        aladhan: 'https://api.aladhan.com/v1',
                    }
                };
                this.state = {
                    location: null, isOnline: navigator.onLine, lastUpdate: {}, timers: {}, adhkarIndex: 0, isVisible: true,
                };
                this.adhkarList = [
                    'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡ÙØŒ Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù',
                    'Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ',
                    'Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù ÙˆÙØ£ÙØªÙÙˆØ¨Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ ÙˆÙØ³ÙÙ„ÙÙ‘Ù…Ù’ Ø¹ÙÙ„ÙÙ‰ Ù†ÙØ¨ÙÙŠÙÙ‘Ù†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù',
                    'Ø±ÙØ¨ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ Ø°ÙÙ†Ù’Ø¨ÙÙŠ ÙˆÙØ®ÙØ·ÙØ¦ÙÙŠ ÙˆÙØ¬ÙÙ‡Ù’Ù„ÙÙŠ',
                    'Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù',
                    'Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ù…ÙÙ†Ù’ ÙÙØ¶Ù’Ù„ÙÙƒÙ ÙˆÙØ±ÙØ­Ù’Ù…ÙØªÙÙƒÙØŒ ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙÙ…Ù’Ù„ÙÙƒÙÙ‡ÙØ§ Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙ',
                    'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù',
                    'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù',
                    'Ø±ÙØ¨ÙÙ‘ Ø£ÙØ¹ÙÙ†ÙÙ‘ÙŠ ÙˆÙÙ„ÙØ§ ØªÙØ¹ÙÙ†Ù’ Ø¹ÙÙ„ÙÙŠÙÙ‘ØŒ ÙˆÙØ§Ù†Ù’ØµÙØ±Ù’Ù†ÙÙŠ ÙˆÙÙ„ÙØ§ ØªÙÙ†Ù’ØµÙØ±Ù’ Ø¹ÙÙ„ÙÙŠÙÙ‘',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ù‡Ù’Ø¯ÙÙ†ÙÙŠ ÙÙÙŠÙ…ÙÙ†Ù’ Ù‡ÙØ¯ÙÙŠÙ’ØªÙØŒ ÙˆÙØ¹ÙØ§ÙÙÙ†ÙÙŠ ÙÙÙŠÙ…ÙÙ†Ù’ Ø¹ÙØ§ÙÙÙŠÙ’ØªÙ',
                    'Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ù„ÙØ§ ØªÙØ¤ÙØ§Ø®ÙØ°Ù’Ù†ÙØ§ Ø¥ÙÙ†Ù’ Ù†ÙØ³ÙÙŠÙ†ÙØ§ Ø£ÙÙˆÙ’ Ø£ÙØ®Ù’Ø·ÙØ£Ù’Ù†ÙØ§',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙØ§Ø±ÙÙƒÙ’ Ù„ÙÙ†ÙØ§ ÙÙÙŠÙ…ÙØ§ Ø±ÙØ²ÙÙ‚Ù’ØªÙÙ†ÙØ§ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù',
                    'ÙŠÙØ§ Ø­ÙÙŠÙÙ‘ ÙŠÙØ§ Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù Ø¨ÙØ±ÙØ­Ù’Ù…ÙØªÙÙƒÙ Ø£ÙØ³Ù’ØªÙØºÙÙŠØ«Ù',
                    'Ø±ÙØ¨ÙÙ‘ Ø§Ø´Ù’Ø±ÙØ­Ù’ Ù„ÙÙŠ ØµÙØ¯Ù’Ø±ÙÙŠ ÙˆÙÙŠÙØ³ÙÙ‘Ø±Ù’ Ù„ÙÙŠ Ø£ÙÙ…Ù’Ø±ÙÙŠ',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØµÙ’Ù„ÙØ­Ù’ Ù„ÙÙŠ Ø¯ÙÙŠÙ†ÙÙŠ ÙˆÙØ¯ÙÙ†Ù’ÙŠÙØ§ÙŠÙ ÙˆÙØ¢Ø®ÙØ±ÙØªÙÙŠ',
                    'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¹ÙØ¯ÙØ¯Ù Ø®ÙÙ„Ù’Ù‚ÙÙ‡Ù ÙˆÙØ±ÙØ¶ÙØ§ Ù†ÙÙÙ’Ø³ÙÙ‡Ù ÙˆÙØ²ÙÙ†ÙØ©Ù Ø¹ÙØ±Ù’Ø´ÙÙ‡Ù ÙˆÙÙ…ÙØ¯ÙØ§Ø¯Ù ÙƒÙÙ„ÙÙ…ÙØ§ØªÙÙ‡Ù',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø­ÙØ²ÙÙ†Ù ÙˆÙØ§Ù„Ù’Ø¹ÙØ¬Ù’Ø²Ù ÙˆÙØ§Ù„Ù’ÙƒÙØ³ÙÙ„Ù',
                    'Ø±ÙØ¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ ÙˆÙØ§Ø±Ù’Ø²ÙÙ‚Ù’Ù†ÙÙŠ ÙÙÙ‡Ù’Ù…Ù‹Ø§',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ÙƒÙ’ÙÙÙ†ÙÙŠ Ø¨ÙØ­ÙÙ„ÙØ§Ù„ÙÙƒÙ Ø¹ÙÙ†Ù’ Ø­ÙØ±ÙØ§Ù…ÙÙƒÙ ÙˆÙØ£ÙØºÙ’Ù†ÙÙ†ÙÙŠ Ø¨ÙÙÙØ¶Ù’Ù„ÙÙƒÙ Ø¹ÙÙ…ÙÙ‘Ù†Ù’ Ø³ÙÙˆÙØ§ÙƒÙ',
                    'Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ù‡ÙØ¨Ù’ Ù„ÙÙ†ÙØ§ Ù…ÙÙ†Ù’ Ø£ÙØ²Ù’ÙˆÙØ§Ø¬ÙÙ†ÙØ§ ÙˆÙØ°ÙØ±ÙÙ‘ÙŠÙÙ‘Ø§ØªÙÙ†ÙØ§ Ù‚ÙØ±ÙÙ‘Ø©Ù Ø£ÙØ¹Ù’ÙŠÙÙ†Ù',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙ„ÙÙ‘ØºÙ’Ù†ÙØ§ Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù ÙˆÙØ£ÙØ¹ÙÙ†ÙÙ‘Ø§ Ø¹ÙÙ„ÙÙ‰ ØµÙÙŠÙØ§Ù…ÙÙ‡Ù ÙˆÙÙ‚ÙÙŠÙØ§Ù…ÙÙ‡Ù',
                    'Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙÙˆÙÙƒÙÙ‘Ù„Ù’ØªÙ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù',
                    'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø·ÙÙ‡ÙÙ‘Ø±Ù’ Ù‚ÙÙ„Ù’Ø¨ÙÙŠ Ù…ÙÙ†Ù Ø§Ù„Ù†ÙÙ‘ÙÙØ§Ù‚Ù ÙˆÙØ¹ÙÙ…ÙÙ„ÙÙŠ Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘ÙŠÙØ§Ø¡Ù'
                ];
                this.init();
            }

            async init() {
                try {
                    this.setupEventListeners();
                    await this.requestLocation();
                    this.startClockUpdate();
                    this.updateCalendar();
                    await this.loadAllData();
                    this.setupPeriodicUpdates();
                    this.setupPerformanceOptimizations();
                } catch (error) {
                    console.error('App initialization failed:', error);
                    this.showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
                }
            }

            setupEventListeners() {
                window.addEventListener('online', () => { this.state.isOnline = true; this.loadAllData(); });
                window.addEventListener('offline', () => { this.state.isOnline = false; this.showOfflineMessage(); });
                document.addEventListener('visibilitychange', () => {
                    this.state.isVisible = !document.hidden;
                    if (this.state.isVisible) this.loadAllData();
                });
                window.addEventListener('error', (e) => console.error('Global error:', e.error));
                window.addEventListener('unhandledrejection', (e) => console.error('Unhandled promise rejection:', e.reason));
            }

            async requestLocation() {
                if (!navigator.geolocation) { this.state.location = this.config.defaultLocation; return; }
                try {
                    const position = await new Promise((res, rej) => {
                        navigator.geolocation.getCurrentPosition(res, rej, { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000 });
                    });
                    this.state.location = { lat: position.coords.latitude, lon: position.coords.longitude };
                } catch {
                    console.warn('Location access denied, using default location');
                    this.state.location = this.config.defaultLocation;
                }
            }

            getArabicDate(date = new Date()) {
                const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
                const months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
                return { dayName: days[date.getDay()], day: date.getDate(), monthName: months[date.getMonth()], year: date.getFullYear() };
            }

            startClockUpdate() {
                const updateClock = () => {
                    if (!this.state.isVisible) return;
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    const displayHours = ((hours % 12) || 12).toString();
                    const timeString = `${displayHours}:${minutes}`;
                    this.updateElement('wgClockVal', timeString);
                    this.updateElement('clock', timeString);
                    this.updateElement('wgClockDay', this.getArabicDate(now).dayName);
                };
                updateClock();
                this.state.timers.clock = setInterval(updateClock, this.config.updateIntervals.clock);
            }

            updateCalendar() {
                const now = new Date();
                const a = this.getArabicDate(now);
                this.updateElement('wgCalVal', a.day);
                this.updateElement('wgCalMonth', `${a.monthName} ${a.year}`);
            }

            async loadHijriDate() {
                if (!this.state.isOnline) return;
                try {
                    const now = new Date();
                    const [year, month, day] = now.toISOString().split('T')[0].split('-');
                    const response = await this.fetchWithTimeout(`${this.config.apis.aladhan}/gToH?date=${day}-${month}-${year}`, 5000);
                    const data = await response.json();
                    const hijri = data?.data?.hijri;
                    if (hijri) {
                        this.updateElement('wgCalHijri', `${hijri.day} ${hijri.month.ar} ${hijri.year}Ù‡Ù€`);
                        this.state.lastUpdate.hijri = Date.now();
                    }
                } catch (error) {
                    console.warn('Hijri date load failed:', error);
                    this.updateElement('wgCalHijri', 'ØºÙŠØ± Ù…ØªØ§Ø­');
                }
            }

            async loadWeather() {
                if (!this.state.isOnline || !this.state.location) return;
                try {
                    this.setLoading(['wgTempVal','wgWeatherVal']);
                    const { lat, lon } = this.state.location;
                    const url = `${this.config.apis.weather}?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m&timezone=auto&forecast_days=1`;
                    const response = await this.fetchWithTimeout(url, 8000);
                    const data = await response.json();
                    const current = data.current;
                    const temp = Math.round(current.temperature_2m || 0);
                    const feels = Math.round(current.apparent_temperature || temp);
                    const windSpeed = Math.round(current.wind_speed_10m || 0);
                    this.updateElement('wgTempVal', `${temp}Â°`);
                    this.updateElement('wgTempFeels', `Ø§Ù„Ø¥Ø­Ø³Ø§Ø³: ${feels}Â°`);
                    this.updateElement('wgWeatherVal', this.getWeatherDescription(current.weather_code));
                    this.updateElement('wgWeatherSub', `Ø±ÙŠØ§Ø­ ${windSpeed} ÙƒÙ…/Ø³`);
                    this.clearLoading(['wgTempVal','wgWeatherVal']);
                    this.state.lastUpdate.weather = Date.now();
                } catch (error) {
                    console.warn('Weather load failed:', error);
                    this.clearLoading(['wgTempVal','wgWeatherVal']);
                    this.updateElement('wgTempVal', '--Â°');
                    this.updateElement('wgTempFeels', 'ØºÙŠØ± Ù…ØªØ§Ø­');
                    this.updateElement('wgWeatherVal', 'ØºÙŠØ± Ù…ØªØ§Ø­');
                    this.updateElement('wgWeatherSub', 'ØºÙŠØ± Ù…ØªØ§Ø­');
                }
            }

            getWeatherDescription(code) {
                const map = {0:'ØµØ­Ùˆ',1:'ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹',2:'ØºØ§Ø¦Ù…',3:'ØºØ§Ø¦Ù… ÙƒÙ„ÙŠØ§Ù‹',45:'Ø¶Ø¨Ø§Ø¨',48:'Ø¶Ø¨Ø§Ø¨ Ù…ØªØ¬Ù…Ø¯',51:'Ø±Ø°Ø§Ø° Ø®ÙÙŠÙ',53:'Ø±Ø°Ø§Ø°',55:'Ø±Ø°Ø§Ø° ÙƒØ«ÙŠÙ',61:'Ù…Ø·Ø± Ø®ÙÙŠÙ',63:'Ù…Ø·Ø±',65:'Ù…Ø·Ø± ØºØ²ÙŠØ±',71:'Ø«Ù„Ø¬ Ø®ÙÙŠÙ',73:'Ø«Ù„Ø¬',75:'Ø«Ù„Ø¬ ÙƒØ«ÙŠÙ',80:'Ø²Ø®Ø§Øª Ø®ÙÙŠÙØ©',81:'Ø²Ø®Ø§Øª',82:'Ø²Ø®Ø§Øª ØºØ²ÙŠØ±Ø©',95:'Ø¹ÙˆØ§ØµÙ Ø±Ø¹Ø¯ÙŠØ©',96:'Ø¹ÙˆØ§ØµÙ Ù…Ø¹ Ø¨Ø±Ø¯',99:'Ø¹ÙˆØ§ØµÙ Ù…Ø¹ Ø¨Ø±Ø¯ ÙƒØ«ÙŠÙ'};
                return map[code] || 'Ù…ØªØºÙŠØ±';
            }

            startAdhkarRotation() {
                const updateAdhkar = () => {
                    if (!this.state.isVisible || this.adhkarList.length === 0) return;
                    const currentThikr = this.adhkarList[this.state.adhkarIndex];
                    this.updateElement('wgAdhkarVal', currentThikr);
                    this.state.adhkarIndex = (this.state.adhkarIndex + 1) % this.adhkarList.length;
                };
                if (this.state.timers.adhkarRotation) clearInterval(this.state.timers.adhkarRotation);
                updateAdhkar();
                this.state.timers.adhkarRotation = setInterval(updateAdhkar, this.config.updateIntervals.adhkarRotation);
            }

            async loadAllData() {
                if (!this.state.isOnline) return;
                await Promise.allSettled([ this.loadHijriDate(), this.loadWeather() ]);
                this.startAdhkarRotation();
            }

            setupPeriodicUpdates() {
                setInterval(() => { if (this.state.isOnline && this.state.isVisible) this.loadWeather(); }, this.config.updateIntervals.weather);
                setInterval(() => { if (this.state.isOnline && this.state.isVisible) this.loadHijriDate(); }, this.config.updateIntervals.hijri);
            }

            setupPerformanceOptimizations() {
                const preferReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
                if (preferReducedMotion.matches) document.documentElement.style.setProperty('--animation-duration', '0s');
                // Ù…ÙƒØ§Ù† Ù…Ø®ØµØµ Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
            }

            async fetchWithTimeout(url, timeout = 5000) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);
                try {
                    const response = await fetch(url, { signal: controller.signal, cache: 'no-cache' });
                    clearTimeout(timeoutId);
                    if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    return response;
                } catch (error) {
                    clearTimeout(timeoutId);
                    throw error;
                }
            }

            updateElement(id, content) {
                const el = document.getElementById(id);
                if (el && el.textContent !== content) el.textContent = content;
            }

            setLoading(ids) {
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.closest('.widget')?.classList.add('loading');
                });
            }
            clearLoading(ids) {
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.closest('.widget')?.classList.remove('loading');
                });
            }

            showError(msg) { console.error(msg); }
            showOfflineMessage() { console.warn('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'); }
            cleanup() { Object.values(this.state.timers).forEach(t => t && clearInterval(t)); }
        }

        const app = new EnhancedDashboardApp();
        window.addEventListener('beforeunload', () => app.cleanup());
    </script>
</body>
</html>
